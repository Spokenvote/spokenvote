%h1 Positions
%br

%table.table
  %tr
    %th Governing Body
    %th Position
    %th Votes
    %th Rank
    %th Votes on Topic

  - @positions.each do |position|
    - all_related_positions_votes_count = [position.ancestors, position.descendants, position].flatten.map(&:votes_count).sort
    %tr
      %td= position.governing_bodies.first.name unless position.parent
      %td
        = link_to 'Improve', new_position_path(:parent_id => position), :class => 'label' 
        = link_to 'Support', '#', 'data-function' => 'display_comment_form', 'data-position_id' => position.id, :class => 'label'
        = link_to position.statement, position_path(position)
      %td= position.votes.count
      %td= all_related_positions_votes_count.index(position.votes_count) + 1
      %td= position.votes_in_tree

%br
= render :partial => 'shared/comment'

= link_to 'New Position', new_position_path